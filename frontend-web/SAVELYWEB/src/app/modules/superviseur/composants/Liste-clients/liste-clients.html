<div class="container-fluid mt-2">
  <div class="dashboard-header mb-4">
    <h2 class="text-dark fw-bold">LISTE DE TOUS LES CLIENTS</h2>
    <p class="text-muted">Gérez et filtrez les comptes épargne des clients SAVELY</p>
  </div>

  <div class="card shadow-sm mb-4 border-0" style="border-radius: 12px; background: white;">
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label small fw-bold">Code Client</label>
          <div class="input-group">
            <span class="input-group-text bg-light border-end-0"><i class="fas fa-barcode"></i></span>
            <input type="text" class="form-control bg-light border-start-0" placeholder="Ex: CLI2025" 
                   [(ngModel)]="filtreCode" (input)="appliquerFiltres()">
          </div>
        </div>
        <div class="col-md-4">
          <label class="form-label small fw-bold">Rechercher Collecteur Assigné</label>
          <div class="input-group">
            <span class="input-group-text bg-light border-end-0"><i class="fas fa-user-tie"></i></span>
            <input type="text" class="form-control bg-light border-start-0" placeholder="Nom" 
                   [(ngModel)]="filtreCollecteur" (input)="appliquerFiltres()">
          </div>
        </div>
        <div class="col-md-4">
          <label class="form-label small fw-bold">Profession Client</label>
          <div class="input-group">
            <span class="input-group-text bg-light border-end-0"><i class="fas fa-briefcase"></i></span>
            <input type="text" class="form-control bg-light border-start-0" placeholder="Ex: Commerçant" 
                   [(ngModel)]="filtreProfession" (input)="appliquerFiltres()">
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="table-container shadow-sm border-0">
    <table class="table align-middle mb-0">
      <thead>
        <tr>
          <th>Code</th>
          <th>Client / Profession</th> <th>Statut</th>
          <th>Collecteur Assigné</th>
          <th>Score</th>
          <th class="text-end">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let c of clientsFiltres">
          <td><span class="badge bg-light text-dark border">{{ c.codeClient }}</span></td>
          <td>
            <div class="user-cell">
              <span class="avatar">{{ (c.nom?.substring(0,1) || '') + (c.prenom?.substring(0,1) || '') }}</span>
              <div class="d-flex flex-column">
                <span class="fw-semibold">{{ c.nom }} {{ c.prenom }}</span>
                <small class="text-primary" style="font-size: 0.75rem;">{{ c.profession }}</small>
              </div>
            </div>
          </td>
          <td>
            <span class="badge" [ngClass]="{
              'bg-success-subtle text-success': c.statut === 'ACTIF',
              'bg-warning-subtle text-warning': c.statut === 'EN_ATTENTE',
              'bg-danger-subtle text-danger': c.statut === 'BLOQUE' || c.statut === 'INACTIF'
            }">
              <i class="fas fa-circle me-1" style="font-size: 0.5rem;"></i> {{ c.statut }}
            </span>
          </td>
          <td>
            <div class="d-flex flex-column">
              <span class="fw-semibold small">{{ c.nomCollecteur || 'Non assigné' }}</span>
              <small class="text-muted" style="font-size: 0.7rem;">ID: {{ c.codeCollecteurAssigne }}</small>
            </div>
          </td>
          <td>
            <div class="d-flex align-items-center gap-2">
              <div class="progress" style="height: 6px; width: 50px;">
                <div class="progress-bar bg-success" [style.width.%]="c.scoreEpargne"></div>
              </div>
              <small class="fw-bold text-muted" style="font-size: 0.75rem;">{{ c.scoreEpargne || 0 }}%</small>
            </div>
          </td>
          <td class="text-end">
            <button class="btn btn-sm btn-light border me-1" (click)="voirDetails(c)"><i class="fas fa-eye text-primary"></i></button>
            <button class="btn btn-sm btn-light border"><i class="fas fa-trash text-danger"></i></button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<div class="modal-backdrop-custom" *ngIf="isModalOpen" (click)="fermerModal()"></div>
<div class="modal-wrapper-custom" *ngIf="isModalOpen">
  <div class="modal-content-custom shadow-lg" *ngIf="clientSelectionne">
    
    <div class="modal-header-custom">
      <h5 class="m-0 fw-bold"><i class="fas fa-user-circle me-2"></i>Détails du Client</h5>
      <button class="btn-close-custom" (click)="fermerModal()">&times;</button>
    </div>

    <div class="modal-body-custom">
      <div class="row g-4">
        <div class="col-md-6 border-end">
          <h6 class="text-primary fw-bold mb-3 border-bottom pb-1">Identité</h6>
          <p><strong>Nom:</strong> {{ clientSelectionne.nom }}</p>
          <p><strong>Prénom:</strong> {{ clientSelectionne.prenom }}</p>
          <p><strong>Profession:</strong> <span class="text-primary">{{ clientSelectionne.profession }}</span></p>
          <p><strong>Téléphone:</strong> {{ clientSelectionne.telephone }}</p>
          <p><strong>Adresse:</strong> {{ clientSelectionne.adresse }}</p>
        </div>
        <div class="col-md-6">
          <h6 class="text-primary fw-bold mb-3 border-bottom pb-1">Compte & Statut</h6>
          <p><strong>Code Client:</strong> <span class="badge bg-dark">{{ clientSelectionne.codeClient }}</span></p>
          <p><strong>Statut:</strong> {{ clientSelectionne.statut }}</p>
          <p><strong>Collecteur:</strong> {{ clientSelectionne.nomCollecteur }}</p>
          <p><strong>Score:</strong> {{ clientSelectionne.scoreEpargne }}%</p>
        </div>
      </div>
    </div>

    <div class="modal-footer-custom text-end">
      <button class="btn btn-secondary" (click)="fermerModal()">Fermer</button>
    </div>
  </div>
</div>