<div class="dashboard-container">
    <div class="dashboard-header">
        <h1>Dashboard Superviseur</h1>
        <div class="user-info">
            <p><strong>{{ dashboard.nomSuperviseur }}</strong></p>
            <p class="agence">{{ dashboard.agenceNom }}</p>
        </div>
        <div class="header-actions">
            <button class="btn-refresh" (click)="rafraichir()" title="Rafra√Æchir">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
    </div>

    <div *ngIf="errorMessage" class="alert alert-danger">
        {{ errorMessage }}
    </div>

    <div *ngIf="isLoading || isLoadingKpis" class="spinner">
        <div class="loading-content">
            <i class="fas fa-circle-notch fa-spin"></i>
            <p>Chargement des donn√©es...</p>
        </div>
    </div>

    <div *ngIf="!isLoading && !isLoadingKpis" class="dashboard-content">
        <!-- KPIs Cards - Row 1 -->
        <div class="kpi-container">
            <div class="kpi-card bg-primary">
                <div class="kpi-icon"><i class="fas fa-clock"></i></div>
                <div class="kpi-value">{{ dashboard.comptesEnAttenteApprobation }}</div>
                <div class="kpi-label">Comptes en Attente</div>
            </div>

            <div class="kpi-card bg-success">
                <div class="kpi-icon"><i class="fas fa-users"></i></div>
                <div class="kpi-value">{{ dashboard.collecteursTotal }}</div>
                <div class="kpi-label">Collecteurs Actifs</div>
            </div>

            <div class="kpi-card bg-info">
                <div class="kpi-icon"><i class="fas fa-coins"></i></div>
                <div class="kpi-value">{{ formatMontant(kpis?.collecteJournaliere || 0) }}</div>
                <div class="kpi-label">Collecte Aujourd'hui</div>
            </div>

            <div class="kpi-card bg-warning">
                <div class="kpi-icon"><i class="fas fa-wallet"></i></div>
                <div class="kpi-value">{{ formatMontant(kpis?.gainSuperviseur || 0) }}</div>
                <div class="kpi-label">Mes Gains</div>
            </div>
        </div>

        <!-- KPIs Cards - Row 2 -->
        <div class="kpi-container">
            <div class="kpi-card bg-teal">
                <div class="kpi-icon"><i class="fas fa-calendar-week"></i></div>
                <div class="kpi-value">{{ formatMontant(kpis?.collecteHebdomadaire || 0) }}</div>
                <div class="kpi-label">Collecte Hebdomadaire</div>
            </div>

            <div class="kpi-card bg-purple">
                <div class="kpi-icon"><i class="fas fa-calendar-alt"></i></div>
                <div class="kpi-value">{{ formatMontant(kpis?.collecteMensuelle || 0) }}</div>
                <div class="kpi-label">Collecte Mensuelle</div>
            </div>

            <div class="kpi-card bg-indigo">
                <div class="kpi-icon"><i class="fas fa-university"></i></div>
                <div class="kpi-value">{{ formatMontant(kpis?.caisseEntreprise || 0) }}</div>
                <div class="kpi-label">Caisse Agence</div>
            </div>

            <div class="kpi-card bg-orange">
                <div class="kpi-icon"><i class="fas fa-chart-line"></i></div>
                <div class="kpi-value">{{ kpis?.nombreTransactions || 0 }}</div>
                <div class="kpi-label">Total Transactions</div>
            </div>
        </div>

        <!-- Meilleurs Collecteurs Section -->
        <div class="section-row">
            <!-- Meilleur Collecteur (Montant) -->
            <div class="section half-width">
                <div class="section-header">
                    <h2><i class="fas fa-trophy"></i> Meilleur Collecteur</h2>
                </div>
                <div *ngIf="kpis?.meilleurCollecteur" class="best-collector-card">
                    <div class="collector-header">
                        <div class="collector-name">
                            {{ kpis?.meilleurCollecteur?.prenom }} {{ kpis?.meilleurCollecteur?.nom }}
                        </div>
                        <div class="collector-badge gold">üèÜ Top Collecteur</div>
                    </div>
                    <div class="collector-stats">
                        <div class="stat">
                            <span class="label">Matricule:</span>
                            <span class="value">{{ kpis?.meilleurCollecteur?.matricule }}</span>
                        </div>
                        <div class="stat">
                            <span class="label">Montant Collect√©:</span>
                            <span class="value highlight">{{ formatMontant(kpis?.meilleurCollecteur?.montantCollecte ||
                                0) }}</span>
                        </div>
                        <div class="stat">
                            <span class="label">Transactions:</span>
                            <span class="value">{{ kpis?.meilleurCollecteur?.nombreTransactions }}</span>
                        </div>
                    </div>
                </div>
                <div *ngIf="!kpis?.meilleurCollecteur" class="no-data">
                    Aucune donn√©e disponible
                </div>
            </div>

            <!-- Collecteur avec Plus de Clients -->
            <div class="section half-width">
                <div class="section-header">
                    <h2><i class="fas fa-user-friends"></i> Plus de Clients</h2>
                </div>
                <div *ngIf="kpis?.collecteurPlusClients" class="best-collector-card clients-card">
                    <div class="collector-header">
                        <div class="collector-name">
                            {{ kpis?.collecteurPlusClients?.prenom }} {{ kpis?.collecteurPlusClients?.nom }}
                        </div>
                        <div class="collector-badge silver">üë• Top Clients</div>
                    </div>
                    <div class="collector-stats">
                        <div class="stat">
                            <span class="label">Matricule:</span>
                            <span class="value">{{ kpis?.collecteurPlusClients?.matricule }}</span>
                        </div>
                        <div class="stat">
                            <span class="label">Nombre de Clients:</span>
                            <span class="value highlight">{{ kpis?.collecteurPlusClients?.nombreClients }}</span>
                        </div>
                        <div class="stat">
                            <span class="label">Montant Collect√©:</span>
                            <span class="value">{{ formatMontant(kpis?.collecteurPlusClients?.montantCollecte || 0)
                                }}</span>
                        </div>
                    </div>
                </div>
                <div *ngIf="!kpis?.collecteurPlusClients" class="no-data">
                    Aucune donn√©e disponible
                </div>
            </div>
        </div>

        <!-- Clients en Retard -->
        <div class="section">
            <div class="section-header">
                <h2><i class="fas fa-exclamation-triangle"></i> Clients en Retard de Cotisation</h2>
            </div>
            <div *ngIf="kpis?.clientsEnRetard && (kpis?.clientsEnRetard?.length || 0) > 0" class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Code Client</th>
                            <th>Nom</th>
                            <th>T√©l√©phone</th>
                            <th>Retard</th>
                            <th>Montant D√ª</th>
                            <th>Int√©r√™ts</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let client of kpis?.clientsEnRetard" class="retard-row">
                            <td class="font-weight-bold">{{ client.codeClient }}</td>
                            <td>{{ client.prenom }} {{ client.nom }}</td>
                            <td>{{ client.telephone }}</td>
                            <td>
                                <span class="badge badge-danger">{{ client.joursRetard }} jours</span>
                            </td>
                            <td>{{ formatMontant(client.montantDu) }}</td>
                            <td class="text-danger">{{ formatMontant(client.interetsRetard) }}</td>
                            <td class="font-weight-bold text-dark">{{ formatMontant(client.montantDu +
                                client.interetsRetard) }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div *ngIf="!kpis?.clientsEnRetard || kpis?.clientsEnRetard?.length === 0" class="no-data">
                <div class="success-icon"><i class="fas fa-check-circle"></i></div>
                <p>Aucun client en retard</p>
            </div>
        </div>

        <!-- Historique Collection -->
        <div class="section">
            <div class="section-header">
                <h2><i class="fas fa-history"></i> Historique Collection</h2>
            </div>
            <div *ngIf="dashboard.historiquesCollection && dashboard.historiquesCollection.length > 0"
                class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>P√©riode</th>
                            <th>Montant</th>
                            <th>Transactions</th>
                            <th>Collecteurs</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let history of dashboard.historiquesCollection">
                            <td class="font-weight-bold">{{ history.periode }}</td>
                            <td class="text-success">{{ formatMontant(history.montant) }}</td>
                            <td>{{ history.nombreTransactions }}</td>
                            <td>{{ history.nombreCollecteurs }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div *ngIf="!dashboard.historiquesCollection || dashboard.historiquesCollection.length === 0"
                class="no-data">
                Aucun historique disponible
            </div>
        </div>
    </div>
</div>